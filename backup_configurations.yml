---
- name: Backup Configurations
  hosts: all
  gather_facts: no
  connection: network_cli
  vars:
    ansible_network_os: ios
    
  tasks:
    - name: Creates backup directory
      file:
        path: "/var/lib/awx/projects/_11__device_upgrade/prechecks"
        state: directory
      run_once: true

    - name: Check directory stats
      stat:
        path: "/var/lib/awx/projects/_11__device_upgrade/prechecks"
      register: dir

    - debug: 
        var: dir
      when: dir is defined

    - name: Remove existing file if it exists
      file:
        path: "/var/lib/awx/projects/_11__device_upgrade/prechecks/precheck_{{ inventory_hostname }}.txt"
        state: absent
      when: dir.stat.exists and dir.stat.isdir

    - name: Creates file
      file:
        path: "/var/lib/awx/projects/_11__device_upgrade/prechecks/precheck_{{ inventory_hostname }}.txt"
        state: touch
      when: dir.stat.exists and dir.stat.isdir
      register: file_path

    - debug: 
        var: file_path
      when: file_path is defined