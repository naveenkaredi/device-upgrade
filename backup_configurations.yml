---
- name: Backup Configurations
  hosts: all
  gather_facts: no
  connection: network_cli
  vars:
    ansible_network_os: ios
    
  tasks:
    - name: Find out playbooks runtime path
      shell: pwd
      register: playbook_path_output
    - debug: var=playbook_path_output.stdout

    - name: Creates backup directory
      file:
        path: "prechecks"
        state: directory
      run_once: true

    - name: Check directory stats
      stat:
        path: "prechecks"
      register: dir

    - name: List contents of runtime path
      shell: "ls {{ playbook_path_output.stdout }}"
      register: ls_output
    - debug: var=ls_output

    - name: Remove existing file if it exists
      file:
        path: "prechecks/prechecks_{{ inventory_hostname }}.txt"
        state: absent
      when: dir.stat.exists and dir.stat.isdir

    - name: Creates file
      file:
        path: "prechecks/prechecks_{{ inventory_hostname }}.txt"
        state: touch
      when: dir.stat.exists and dir.stat.isdir
      register: file_path
